<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">

  <link rel="apple-touch-icon"
        sizes="180x180"
        href="/apple-touch-icon.png">
  <link rel="icon"
        type="image/png"
        sizes="16x16"
        href="/favicon-16x16.png">
  <link rel="manifest"
        href="/manifest.json">
  <link rel="mask-icon"
        href="/safari-pinned-tab.svg"
        color="#5bbad5">
  <meta name="theme-color"
        content="#d9d9d9">
  
    <title> My (Paranoid) Git Setup | CodeSections </title>
  
<style> 
/*==================================*\
  ##All CSS for this page
\*==================================*/

/*  Theme colors:
 *
 *  #fd0     yellow (menu bar [old])
 *  #cde     pastel blue (note boxes)
 *  #000     true black (site header)
 *  #4F82BB; Dark Blue  (Nav bar)
 *  #223     near black (text & logo)
 *  #fff     white (menu text)
 *  #07e     sky blue (links)
 */
/*==================================*\
  ##Global
\*==================================*/
html {
  font-family: -apple-system,
               BlinkMacSystemFont,
               'Segoe UI',
               Roboto,
               'Helvetica Neue',
               Arial, sans-serif;
  color: #223; /*near black*/
}
  
/*==================================*\
  ##Nav bar
\*==================================*/
.nav-bar {
  position: fixed;
  z-index: 1;
  left: 0;
  width: 100%;
  padding: 0;
  background-color: #4F82BB; /*Dark Blue*/
  box-shadow: 0 3px 6px rgba(0, 0, 0, .3);
}

.nav-bar--top {
  top: 0;
}

.nav-bar__container {
  display: flex;
  max-width: 700; /*max comfortable line length*/
  padding-left: 8px;
  padding-right:8px;
  margin: auto;
  justify-content: space-between;
}

.nav-bar__button {
  position: relative;
  /*  This isn't needed for display of this element,
   *  but important for the :after pseudo element
   *  below. */
  cursor: pointer;
  background-color: inherit;
  height: 1.25em;
}

.nav-bar__button:not(.nav-bar__button--current-page) {
  color: white;
}

.nav-bar__link {
  color: inherit;
  text-decoration: none;
}

.nav-bar__link::selection {
  background-color: inherit;
  color: inherit;
}

.nav-bar__link:after {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 0;
  height: 0;
  content: "";
  transition: all 0.4s ease;
  border-top: 3px solid #223; /*near black*/
}

.nav-bar__button:not(.nav-bar__button--current-page)
  .nav-bar__link:hover:after {
    width: 100%;
}

.svg__logo {
  height: 40px;
  width: 40px;
}

@media (max-width: 599px) { /*Phone only*/
  .nav-bar__button {
    font-size: 1.382em;
    line-height: 1.382em;
    /*  The goal is creating a larger target for
     *  touch navigation while also shrinking
     *  the amount of horizontal space devoted to
     *  the menu.*/
  }
}

@media (min-width: 600px) {  /*Tablet-portrait & up*/
  .nav-bar__button {
    font-size: 2em;
  }
  .svg__logo {
    height: 64px;
    width: 64px;
  }
}
  
/*==================================*\
  ##Main content
\*==================================*/
.content-main{
  margin-top: 2em;
  min-height: calc(100vh - 100px - 2.9em);
  /*  This equals [fullscreen - (top margin) -
   *  (space for the 2-line footer, with margin)]*/
  max-width: 700px; /*  Match nav container width*/
  margin-left: auto;
  margin-right: auto;
  padding: .1em;
  font-size: 1.15em;
  line-height: 1.6em;
  color: #444;
}

article {
  padding: .75em;
  padding-top: 0;
  border-style: solid;
  border-color: #f2f2f2;
  border-radius: 13.3px;
  border-width: 1.5px;
  margin-top: 1em;
  margin-bottom: 1em;
  box-shadow: 1px 1px 25px #f2f2f2;
}

@media (min-width:  600px) { /*Tablet-portrait & up*/
  article {
    margin-top: 2em;
  }
}

table {
  overflow: auto;
  border-spacing: 0;
  margin: auto;
}

table th {
  font-weight: 600;
}

table th,
table td {
  padding: 6px 13px;
  border: 0.5px solid #dfe2e5;
}

table tr {
  background-color: #fff;
  border-top: 1px solid #c6cbd1;
}

table tr:nth-child(2n) {
  background-color: #f6f8fa;
}

.site-header{
  margin-bottom: 0;
  margin-top: 1em;
  text-align: left;
  font-size: 1.618em;
  font-weight: 400;
  line-height: .85;
  color: #000;
}

.content-p {
  color: #223; /*near black*/
  margin-top: 1em;
  margin-bottom: 0;
}

.link,
a {
  color: #07e; /*sky blue*/
  text-decoration: none;
}

.note {
  background-color: #cde; /* Pastel blue*/
  display: block;
  padding: .5em;
  margin-top: 1em;
  color: #0d1d25; /*near black*/
  border: solid 2px #0d1d25; /* Near black*/
}

p code,
ul code {
  padding: 2px 4px;
  color: #c0341d;
  background-color: #fbe5e1;
  border-radius: 3px;
}

pre {
  overflow-x: scroll;
}

img {
  width: 100%;
}

.highlight {
  overflow: auto;
}

.header__blog {
  margin: auto;
  width: 175px;
  width: fit-content;
  position: relative;
  margin-top: -5px;
  margin-bottom: -15px;
}
@media (min-width:  600px) { /*Tablet-portrait & up*/
  header__blog {
    margin-right: calc(50% - 55px);
  }
}

.blog-title {
  position: absolute;
  display: inline;
  top: 54px;
}

.blog-title--left {
  right: 180px;
  display: none;
}

.blog-title--right {
  left: 180px;
  display: none;
}
@media (min-width:  600px) { /*Tablet-portrait & up*/
  .blog-title--right,
  .blog-title--left {
    display: inline;
  }
}

.pagination-nav {
  display: flex;
  justify-content: space-around;
}

@media (min-width:  600px) { /*Tablet-portrait & up*/
  .site-header {
    font-size:  2.618em;
    padding-top: 4vh;
    padding-bottom: 1vh;
  }
}
  
/*==================================*\
  ##Footer
\*==================================*/
.footer {
  margin-top: 1em;
  text-align: center;
}




</style>
</head>
<body>
<nav class="nav-bar nav-bar--top">
  <div class="nav-bar__container">
    <div class="nav-bar__button"><a class="nav-bar__link" href="/">Home</a></div>
    <div class="nav-bar__button"><a class="nav-bar__link" href="/about">About</a></div>
    <div class="nav-bar__button">
      <a href="/">
        <!-- The code for the site logo, which is an inline SVG because that loads faster-->
        <svg class="svg__logo" viewBox="0 60 700 700" >
          <circle r="412.74" fill="#4F82bb" cy="250" cx="350"></circle>        
          <path d="M 291,128 C 259,154 252,196 268,229 c 11,20
          32,29 40,37 -36,16 -57,44 -59,85 -1,64 56,91 99,111 39,11
          56,62 29,96 -8,12 -52,18 -60,-4 -21,-76 -86,-28 -40,24 37,20
          82,23 120,-1 19,-14 39,-47 36,-81 -5,-34 -21,-44 -49,-66 61,-32
          74,-124 21,-155 C 364,249 307,232 300,196 290,145 325,132 357,132
          c 29,1 33,31 41,45 31,28 39,-12 34,-27 C 415,98 327,104 291,128 Z
          m 69,292 C 268,381 271,320 331,279 c 100,9 81,111 30,141 z M 0,347
          C 42,395 168,539 207,581 c 0,-33 0,-57 0,-94 -41,-46 -85,-96
          -123,-139 37,-49 85,-98 123,-143 0,-16 -0,-81 -1,-93 C 136,195
          71,271 0,347 Z M 487,111 c -0,32 -0,56 -1.7e-4,90 38,45 96,111
          123,143 C 568,396 526,446 487,490 c 0,10 1,82 1,90 C 544,518
          633,420 696,345 645,287 534,164 487,111 Z" />
        </svg>
      </a>
    </div>
    <div class="nav-bar__button"><a class="nav-bar__link" href="/blog">Blog</a></div>
    <div class="nav-bar__button"><a class="nav-bar__link" href="/projects">Projects</a></div>
  </div>
</nav>

<section class="content-main">
  
  <h2>My (Paranoid) Git Setup</h2>
  <p>Until recently, I had a very simple git workflow: I worked in a local repository, and then pushed my changes to a single remote, which lived at GitHub.  In the case of the <a href="https://www.gitlab.com/codesections/codesections-website">code for this site</a>, pushing to GitHub would automatically trigger a rebuild of the website and publish the changes live to the Internet. (Thanks, <a href="https://www.netlify.com">Netlify</a>!)</p>
<p>This setup had the virtue of simplicity, but it had three important drawbacks:</p>
<ul>
<li>I had no backups of any changes I'd made but not published.  For example, if I had a draft blog post, it lived <em>only</em> on my laptop, and thus could easily be lost.  This isn't <em>that</em> big of a deal with my current workflow—unlike some <a href="https://fosstodon.org/@h4ck3r9/100174544939337521">some</a> bloggers, I don't tend to keep a ton of posts as drafts.  Still, though, I'd like to not lose what I do have, and I always might keep more drafts in the future.</li>
<li>I was relying heavily on GitHub to publish updates to my site.  If GitHub were down or locked me out of my account or something, I would have no <em>easy</em> way to make posts to my blog.  I could migrate to a different git host or manually update Netlify, but it wouldn't be seamless.</li>
<li>I had only one backup of the site, and that was on GitHub.  If anything happen to my computer, I'd be 100% relying on GitHub for all of my site content.</li>
</ul>
<p>So, over the past week, I decided to fix all of these issues.  With my new setup, I have:</p>
<ol>
<li>A git server on a Raspberry Pi on my home LAN.</li>
<li>A git server on a cheep shared host.</li>
<li>A GitHub-hosted repository.</li>
<li>A GitLab-hosted repository.</li>
</ol>
<p><a name="continue-reading"></a></p>
<p>And here's my new workflow: As I'm working on content locally, I commit my changes and then <code>git push</code>, which is configured to push my changes <em>only</em> to the Pi.  When I'm ready to publish changes, run <code>git push all</code>, which pushes to all four remote repos, and triggers Netlify to rebuild the site.  (I also switched to using GitLab as the main repository that Netlify builds off of, but that was more of a reaction to the GitHub acquisition than a change related to the above.)</p>
<p>This means that I have a local backup of everything on the Pi and that I have three additional backups of the published content.  What's more, if I ever lose access to GitLab, I could seamlessly switch back to GitHub and tell Netlify to build off of that repo, which eliminates a point of failure.</p>
<p>I'm very happy with this new workflow, but it took a bit of figuring to get it all set up.  The rest of this post provides a guide for how to set up a similar workflow.  This may be old hat for people with a bit more git experience, but it took me some googling to figure out, so I thought it might be helpful to others.</p>
<h2 id="how-to-set-up-a-similar-workflow">How to set up a similar workflow</h2>
<h3 id="1-initialize-a-local-git-repo-and-make-your-initial-commit">1. Initialize a local git repo and make your initial commit</h3>
<p>(If you already have a local git repo set up, you can skip this step.)</p>
<p>From within the directory that contains your project, run <code>git init</code>, which creates a new repository.  Then run <code>git add .</code> to begin tracking all the files in the directory, and <code>git commit -am &quot;Intial commit&quot;</code> to commit the current state of your repository locally.</p>
<h3 id="2-push-your-changes-to-the-raspberry-pi-or-other-server-for-backup">2. Push your changes to the Raspberry Pi (or other server for backup)</h3>
<p>First, SSH into the server you intend to use for backup of unpublished content—in my case, the local Pi.  For my setup, this means running <code>ssh pi@192.168.0.102</code>, but your command will differ depending on the username and IP address.</p>
<p>From the server, run <code>git init --bare &lt;name_of_project&gt;</code>.  The <code>--bare</code> flag tells git that there isn't a local working directory, which will prevent it from viewing the lack of files as a problem.</p>
<p>Then, end the SSH session and run <code>git remote add origin &lt;username&gt;@&lt;IP&gt;:&lt;path/to/project&gt;</code>.  In my case, when setting up the repo for this site, I ran <code>git remore add origin pi@192.168.0.102:/home/pi/projects/codesections</code>.</p>
<p>Run <code>git push --set-upstream master</code> to push to the server.</p>
<h3 id="3-add-the-remote-servers-for-production-deployment">3.  Add the remote servers for production deployment</h3>
<p>Up through this point, we've been using very basic git commands.  Here's where it gets (slightly) more advanced.</p>
<p>In this example, we'll be setting up three additional servers: one remote sever, a GitHub one, and a GitLab one.  But you could omit one or two of these severs if desired.</p>
<p>If you are running three, first SSH into the remote server and initialize the bare repo (the same process from step 2, above).  Then create new GitHub and GitLab repos using their web interface.</p>
<p>Finally, run the following commands:</p>
<ul>
<li><code>git remote add all &lt;gitlab-git-url&gt;</code>.  (So, in my case <code>git remote add all git@gitlab.com:codesections/codesections-website</code>.)</li>
<li><code>git remote set-url all &lt;github-git-url&gt;</code>. (So, in my case <code>git remote set-url git@github.com:dsock/codesections</code>.)</li>
<li><code>git remote set-url all &lt;remote-server-url&gt;</code>.</li>
<li><code>git remote set-url all &lt;pi-git-url&gt;</code>. (In my case, <code>git remote set-url pi@192.168.0.102:/home/pi/projects/codesections</code>.)</li>
</ul>
<p>Now, you can run <code>git push all</code> to push your changes to all the remote repos.</p>


</section>
 
<footer class="footer">
  <div class="footer_copyright">
    © 2018 | <a href="/rss.xml" type="application/rss+xml" > RSS </a> | <a class="link" href="/license/">    Some Rights Reserved</a>
  </div>
  <div class="footer_contact">
    <a class="link" href="https://gitlab.com/codesections">GitLab</a> |
    <a class="link" href="https://github.com/dsock">GitHub</a> |
    <a class="link" href="https://www.linkedin.com/in/daniel-sockwell/">LinkedIn</a> |
    <a class="link" href="https://fosstodon.org/@codesections">Mastodon</a> |
    <a class="link" href="mailto:daniel-public-email@codesections.com">Email</a>
  </div>
</footer>


</body>
</html>
